<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.bitoffer.xtimer.mapper.TaskMapper">
    <insert id="batchSave" useGeneratedKeys="true">
        insert into timer_task (`app`,`timer_id`,`output`,`run_timer`,`cost_time`,`status`)
        values
            <foreach collection="taskList" item="taskModel" separator=",">
                (#{taskModel.app},#{taskModel.timerId},#{taskModel.output},#{taskModel.runTimer},#{taskModel.costTime},#{taskModel.status});
            </foreach>
    </insert>
    <delete id="deleteById">
        delete from timer_task where task_id = #{taskId};
    </delete>
    <update id="update">
        update timer_task
        <set>
            <if test="taskModel.app != null">
                `app` = #{taskModel.app},
            </if>
            <if test="taskModel.timer_id != null">
                `name` = #{taskModel.timerId},
            </if>
            <if test="taskModel.output != null">
                `name` = #{taskModel.output},
            </if>
            <if test="taskModel.run_timer != null">
                `name` = #{taskModel.runTimer},
            </if>
            <if test="taskModel.cost_time != null">
                `name` = #{taskModel.costTime},
            </if>
            <if test="taskModel.status != null">
                `name` = #{taskModel.status},
            </if>
        </set>
        where task_id = #{taskModel.taskId};
    </update>

    <resultMap id="getTaskList" type="com.zdf.flowsvr.data.AsyncFlowTask">
        <result column="id" jdbcType="BIGINT" property="id" />
        <result column="user_id" jdbcType="VARCHAR" property="user_id"/>
        <result column="task_id" jdbcType="VARCHAR" property="task_id"/>
        <result column="task_type" jdbcType="VARCHAR" property="task_type"/>
        <result column="task_stage" jdbcType="VARCHAR" property="task_stage"/>
        <result column="status" jdbcType="INTEGER" property="status"/>
        <result column="crt_retry_num" jdbcType="INTEGER" property="crt_retry_num"/>
        <result column="max_retry_num" jdbcType="INTEGER" property="max_retry_num"/>
        <result column="priority" jdbcType="INTEGER" property="priority"/>
        <result column="order_time" jdbcType="BIGINT" property="order_time"/>
        <result column="max_retry_interval" jdbcType="INTEGER" property="max_retry_interval"/>
        <result column="schedule_log" jdbcType="VARCHAR" property="schedule_log"/>
        <result column="task_context" jdbcType="VARCHAR" property="task_context"/>
        <result column="create_time" jdbcType="BIGINT" property="create_time"/>
        <result column="modify_time" jdbcType="BIGINT" property="modify_time"/>
    </resultMap>
    <select id="getTaskList" resultMap="getTaskList">
        select * from timer_task where timer_id = #{timerId};
    </select>
</mapper>
